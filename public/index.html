<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#0a0a0a" />
    <meta
      name="description"
      content="3D Immersive Homepage - Digital Depth Experience"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <link rel="stylesheet" href="%PUBLIC_URL%/style.css" />
    <title>Digital Depth - 3D Immersive</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    
    <div id="root"></div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
      <div class="loading-text">Loading...</div>
    </div>

    <!-- Noise Texture Overlay -->
    <div class="noise-overlay"></div>

    <!-- Three.js Canvas -->
    <canvas id="three-canvas"></canvas>

    <!-- Glassmorphism Navbar -->
    <nav class="glass-navbar">
      <div class="nav-content">
        <div class="nav-logo">UNSPACE</div>
        <div class="nav-links">
          <a href="#marketplace">MARKETPLACE</a>
          <a href="#community">COMMUNITY</a>
          <a href="#signin">SIGN IN</a>
        </div>
      </div>
    </nav>

    <!-- Glassmorphism Hero Text -->
    <section class="glass-hero">
      <h1 class="hero-title">THE ONLY CAMPUS PLATFORM</h1>
      <h2 class="hero-subtitle">THAT CONNECTS AS WELL AS IT EMPOWERS</h2>
      <button class="hero-cta">EXPLORE NOW</button>
    </section>

    <!-- Three.js ES Module -->
    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
          "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
      }
    </script>
    <script type="module">
      import * as THREE from 'three';
      import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
      import { FontLoader } from 'three/addons/loaders/FontLoader.js';
      import { TextGeometry } from 'three/addons/geometries/TextGeometry.js';

      // Scene setup
      const scene = new THREE.Scene();
      scene.background = new THREE.Color(0x0a0a0a);

      // Camera
      const camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      );
      camera.position.z = 5;

      // Renderer
      const canvas = document.getElementById('three-canvas');
      const renderer = new THREE.WebGLRenderer({ 
        canvas: canvas,
        antialias: true,
        alpha: true
      });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(window.devicePixelRatio);

      // Controls
      const controls = new OrbitControls(camera, canvas);
      controls.enableDamping = true;
      controls.dampingFactor = 0.05;
      controls.enableZoom = false;
      controls.enablePan = false;
      controls.autoRotate = true;
      controls.autoRotateSpeed = 0.5;

      // Mouse position for parallax
      let mouseX = 0;
      let mouseY = 0;
      let targetRotationX = 0;
      let targetRotationY = 0;

      // Track mouse movement
      document.addEventListener('mousemove', (event) => {
        mouseX = (event.clientX / window.innerWidth) * 2 - 1;
        mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
        targetRotationX = mouseY * 0.3;
        targetRotationY = mouseX * 0.3;
      });

      // 3D Object (will be set after font loads or fallback)
      let mesh = null;
      let fontLoaded = false;

      // Font loader with fallback
      const fontLoader = new FontLoader();
      const fontUrl = 'https://threejs.org/examples/fonts/helvetiker_regular.typeface.json';

      fontLoader.load(
        fontUrl,
        (font) => {
          // Success: Create 3D text
          const textGeometry = new TextGeometry('UNSPACE', {
            font: font,
            size: 0.8,
            height: 0.3,
            curveSegments: 12,
            bevelEnabled: true,
            bevelThickness: 0.03,
            bevelSize: 0.02,
            bevelOffset: 0,
            bevelSegments: 5
          });

          textGeometry.center();

          const textMaterial = new THREE.MeshNormalMaterial();
          mesh = new THREE.Mesh(textGeometry, textMaterial);
          scene.add(mesh);
          fontLoaded = true;
          
          // Hide loading overlay after scene is ready
          hideLoadingOverlay();
        },
        undefined,
        (error) => {
          // Error: Fallback to Icosahedron
          console.warn('Font failed to load, using Icosahedron fallback:', error);
          const geometry = new THREE.IcosahedronGeometry(1.5, 1);
          const material = new THREE.MeshNormalMaterial();
          mesh = new THREE.Mesh(geometry, material);
          scene.add(mesh);
          fontLoaded = true;
          
          // Hide loading overlay after scene is ready
          hideLoadingOverlay();
        }
      );

      // Hide loading overlay function
      function hideLoadingOverlay() {
        const overlay = document.getElementById('loading-overlay');
        if (overlay) {
          overlay.style.opacity = '0';
          setTimeout(() => {
            overlay.style.display = 'none';
          }, 500);
        }
      }

      // Animation loop
      function animate() {
        requestAnimationFrame(animate);

        // Smooth parallax rotation
        if (mesh) {
          mesh.rotation.x += (targetRotationX - mesh.rotation.x) * 0.05;
          mesh.rotation.y += (targetRotationY - mesh.rotation.y) * 0.05;
          
          // Auto-rotation
          mesh.rotation.z += 0.005;
        }

        controls.update();
        renderer.render(scene, camera);
      }

      // Handle window resize
      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
      });

      // Start animation
      animate();
    </script>
  </body>
</html>